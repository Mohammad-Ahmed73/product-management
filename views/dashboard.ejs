<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
    <title>Document</title>
</head>

<body>
    <header class="py-3">
        <div class="container-lg">
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <a class="navbar-brand" href="/">Product Management</a>
                <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="/login">Login</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/register">Sign Up</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
    </header>
    <div class="container-lg py-5">
        <!-- Product Listing -->
        <% if (products.length===0) { %>
            <p>No products available.</p>
            <% } else { %>
                <section class="product-list mb-4">
                    <h3 class="mb-3">Product List</h3>
                    <table class="w-100" style="table-layout: fixed;">
                        <tr>
                            <% if (currentRole===1 || currentRole===3) { %>
                                <th>Product ID</th>
                                <% } %>
                                    <th>Product Name</th>
                                    <th>Product Price</th>
                                    <th>Product Qunatity</th>
                                    <% if (currentRole===1 || currentRole===3) { %>
                                        <th>Action</th>
                                        <% } %>
                        </tr>
                        <% products.forEach( (product)=> { %>
                            <tr>
                                <% if (currentRole===1 || currentRole===3) { %>
                                    <td>
                                        <%= product.product_id %>
                                    </td>
                                    <% } %>
                                        <td>
                                            <%= product.product_name %>
                                        </td>
                                        <td>
                                            $<%= product.product_price %>
                                        </td>
                                        <td>
                                            <%= product.product_quantity %>
                                        </td>
                                        <% if (currentRole===1 || currentRole===3) { %>
                                            <td>
                                                <button type="button" class="btn btn-primary"
                                                    data-pid="<%= product.product_id %>" onclick="showEditForm(this)"
                                                    data-bs-toggle="modal" data-bs-target="#update-product">
                                                    Edit
                                                </button>
                                                <button type="button" class="btn btn-primary"><a
                                                        href="/deleteproduct/<%=product.product_id %>">Delete</a></button>
                                            </td>
                                            <% } %>
                            </tr>
                            <% }) %>
                    </table>
                </section>
                <% } %>


                    <div class="modal" id="update-product" tabindex="-1" aria-labelledby="exampleModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <form action="/editProduct" class="" method="POST">
                                    <div class="modal-header justify-content-center">
                                        <h5 class="modal-title">Update Product</h5>
                                    </div>
                                    <div class="modal-body">
                                        <% products.forEach( (product)=> { %>
                                            <div id="edit-form-<%=product.product_id %>" style="display: none;"
                                                class="edit-row">
                                                <input type="hidden" name="product_id" value=<%=product.product_id %>>
                                                <input type="text" value=<%=product.product_name %>
                                                id="edit-product-name"
                                                name="product_name">
                                                <input type="number" name="product_price" value=<%=product.product_price
                                                    %>
                                                id="edit-product-price">
                                                <input type="number" name="product_quantity"
                                                    value=<%=product.product_quantity %>
                                                id="edit-product-quantity">

                                            </div>
                                            <% }) %>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                                            id="close-modal">Close</button>
                                        <button type="submit" class="btn primary-btn">
                                            Update
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                        <!-- Product Addition Form for Admin -->
                        <section class="product-form mb-4">
                            <% if (currentRole === 1) { %>
                                <h2 class="mb-3">Add Product</h2>
                                <form action="/dashboard" method="post" id="addProductForm">
                                    <div class="mb-3">
                                        <label for="product-name" class="form-label">Product Name</label>
                                        <input type="text" name="product_name" class="form-control" id="" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="product-price" class="form-label">Product Price</label>
                                        <input type="number" name="product_price" class="form-control" id="" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="product-quantity" class="form-label">Product Quantity</label>
                                        <input type="number" name="product_quantity" class="form-control" id=""
                                            required>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-auto">Add Product</button>
                                </form>
                                <% } else { %>
                                    <p>You do not have permission to add products.</p>
                                    <% } %>
                        </section>
    </div>

    <footer class="bg-dark text-white py-3">
        <div class="container text-center">
            <p class="mb-0">&copy; 2023 Product Management Dashboard</p>
        </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- <script src="/script.js" type="javascript"></script> -->
    <script>
        // Get all the delete product buttons
        const deleteButtons = document.querySelectorAll('.delete-product');

        // Add event listener to each delete button
        deleteButtons.forEach(button => {
            button.addEventListener('click', () => {
                const dataPid = button.getAttribute('data-pid');
                console.log(`Clicked Delete for product ID: ${dataPid}`);
                // Perform delete operation or other logic here
            });
        });

        function showEditForm(button) {
            // Get the product ID from the clicked button's data-pid attribute
            const productId = button.getAttribute('data-pid');
            // Fetch the product data for the given product ID (you can use AJAX or render the form server-side)


            // Populate the form fields with the product data
            document.getElementById(`edit-form-${productId}`).style.display = 'block';
        }

        jQuery("#close-modal").click(function () {
            jQuery('.edit-row').hide();
        });



    </script>
</body>

</html>